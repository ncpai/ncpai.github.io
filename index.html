<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªôi ƒê·ªìng Chuy√™n Gia AI - H·ªá Th·ªëng T√¨m Ki·∫øm Quy Lu·∫≠t</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #F9FAFB;
        }
        .btn {
            transition: all 0.3s ease;
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .card {
            background-color: #1F2937;
            border: 1px solid #374151;
        }
        .progress-bar-container {
            background-color: #374151;
            border-radius: 9999px;
            overflow: hidden;
        }
        .progress-bar {
            background: linear-gradient(to right, #4f46e5, #a855f7);
            transition: width 0.5s ease-in-out;
        }
        .log-item {
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .blinking-cursor {
            font-weight: bold;
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            from, to { color: transparent }
            50% { color: #60A5FA; }
        }
    </style>
</head>
<body class="p-4 md:p-8">

<div class="max-w-4xl mx-auto space-y-6">

    <!-- Header -->
    <div class="text-center p-6">
        <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-cyan-400">H·ªôi ƒê·ªìng Chuy√™n Gia AI</h1>
        <p class="text-gray-400 mt-2">N∆°i c√°c AI c√πng nhau nghi√™n c·ª©u, tranh lu·∫≠n v√† t√¨m ra b·ªô quy lu·∫≠t t·ªëi ∆∞u.</p>
    </div>

    <!-- Step 1: Input -->
    <div class="card p-6 rounded-2xl shadow-lg">
        <h2 class="text-2xl font-semibold mb-4 text-cyan-300 flex items-center">
            <span class="bg-cyan-500 text-gray-900 rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">1</span>
            Thi·∫øt l·∫≠p H·ªôi ƒë·ªìng & Cung c·∫•p D·ªØ li·ªáu
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input type="password" id="geminiApiKey1" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="API Key 1: Chuy√™n gia C·∫ßu B·ªát">
            <input type="password" id="geminiApiKey2" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="API Key 2: Chuy√™n gia M·∫´u H√¨nh">
            <input type="password" id="geminiApiKey3" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="API Key 3: Nh√† Th·ªëng K√™">
            <input type="password" id="geminiApiKey4" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="API Key 4: Nh√† Ph·∫£n Bi·ªán">
            <input type="password" id="geminiApiKey5" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="API Key 5: Ch·ªß T·ªãch H·ªôi ƒê·ªìng">
        </div>
        <div class="mt-4">
            <label class="block text-sm font-medium text-gray-300 mb-2">T·ªáp D·ªØ Li·ªáu L·ªãch S·ª≠ (.json)</label>
            <div class="flex items-center">
                <label for="fileInput" class="btn w-full text-center bg-purple-600 hover:bg-purple-500 text-white font-bold py-2 px-4 rounded-lg cursor-pointer">
                    üì§ T·∫£i L√™n "S√°ch Gi√°o Khoa"
                </label>
                <input type="file" id="fileInput" class="hidden" accept=".json">
                <span id="fileName" class="ml-4 text-gray-400 truncate">Ch∆∞a c√≥ t·ªáp n√†o ƒë∆∞·ª£c ch·ªçn...</span>
            </div>
        </div>
    </div>

    <!-- Step 2: Analysis -->
    <div class="card p-6 rounded-2xl shadow-lg">
        <h2 class="text-2xl font-semibold mb-4 text-indigo-300 flex items-center">
            <span class="bg-indigo-500 text-gray-900 rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">2</span>
            B·∫Øt ƒë·∫ßu phi√™n h·ªçp H·ªôi ƒë·ªìng
        </h2>
        <button id="startButton" onclick="startAnalysis()" class="btn w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-4 rounded-lg text-lg" disabled>
            B·∫Øt ƒë·∫ßu Ph√¢n t√≠ch
        </button>
        
        <div id="analysis-progress" class="mt-6 space-y-4 hidden">
            <div class="flex justify-between items-center text-sm font-medium">
                <span id="statusText" class="text-gray-300">ƒêang chu·∫©n b·ªã...</span>
                <span id="progressText" class="text-indigo-400 font-bold">0%</span>
            </div>
            <div class="progress-bar-container w-full h-2.5">
                <div id="progressBar" class="progress-bar h-2.5" style="width: 0%"></div>
            </div>
             <div id="log-container" class="mt-4 bg-gray-900 p-4 rounded-lg h-64 overflow-y-auto font-mono text-sm text-gray-300">
                <p>Kh·ªüi t·∫°o m√¥i tr∆∞·ªùng nghi√™n c·ª©u... <span class="blinking-cursor">_</span></p>
             </div>
        </div>
    </div>

    <!-- Step 3: Output -->
    <div id="results-card" class="card p-6 rounded-2xl shadow-lg hidden">
         <h2 class="text-2xl font-semibold mb-4 text-green-300 flex items-center">
            <span class="bg-green-500 text-gray-900 rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">3</span>
            C√¥ng Tr√¨nh Nghi√™n C·ª©u Ho√†n T·∫•t
        </h2>
        <div id="final-stats" class="mb-4 bg-gray-800 p-4 rounded-lg text-center">
             <p class="text-lg">ƒê·ªô ch√≠nh x√°c cu·ªëi c√πng ƒë√£ ƒë∆∞·ª£c ki·ªÉm ch·ª©ng:</p>
             <p id="finalAccuracy" class="text-4xl font-bold text-green-400 mt-1">0.0%</p>
        </div>
        <div class="bg-gray-900 p-4 rounded-lg">
            <h3 class="font-semibold text-lg mb-2 text-gray-300">Quy lu·∫≠t & Ph∆∞∆°ng ph√°p ƒë∆∞·ª£c t√¨m th·∫•y:</h3>
            <pre id="finalRules" class="whitespace-pre-wrap text-gray-400 text-sm"></pre>
        </div>
        <button onclick="downloadResults()" class="btn w-full mt-6 bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-4 rounded-lg text-lg">
            üì• T·∫£i V·ªÅ C√¥ng Tr√¨nh Nghi√™n C·ª©u
        </button>
    </div>

</div>

<script>
let state = {
    apiKeys: [],
    fullHistory: [],
    finalRuleset: {
        rules: '',
        accuracy: 0,
        explanation: ''
    },
    isAnalyzing: false,
};

// --- UI Management ---
const fileInput = document.getElementById('fileInput');
const fileNameEl = document.getElementById('fileName');
const startButton = document.getElementById('startButton');
const apiKeyInputs = Array.from({length: 5}, (_, i) => document.getElementById(`geminiApiKey${i+1}`));
const analysisProgressEl = document.getElementById('analysis-progress');
const resultsCardEl = document.getElementById('results-card');
const logContainer = document.getElementById('log-container');
const statusTextEl = document.getElementById('statusText');
const progressBarEl = document.getElementById('progressBar');
const progressTextEl = document.getElementById('progressText');

fileInput.addEventListener('change', () => {
    if (fileInput.files.length > 0) {
        fileNameEl.textContent = fileInput.files[0].name;
        checkCanStart();
    }
});
apiKeyInputs.forEach(input => input.addEventListener('input', checkCanStart));

function checkCanStart() {
    const allKeysFilled = apiKeyInputs.every(input => input.value.trim());
    startButton.disabled = !(allKeysFilled && fileInput.files.length > 0);
}

function logMessage(message, isImportant = false) {
    const cursor = logContainer.querySelector('.blinking-cursor');
    if (cursor) cursor.parentElement.remove();
    
    const p = document.createElement('p');
    p.className = 'log-item';
    if(isImportant) p.className += ' text-cyan-400 font-semibold';
    p.innerHTML = `${message} <span class="blinking-cursor">_</span>`;
    logContainer.appendChild(p);
    logContainer.scrollTop = logContainer.scrollHeight;
}

function updateProgress(percentage, status) {
    percentage = Math.min(100, Math.max(0, percentage));
    progressBarEl.style.width = `${percentage}%`;
    progressTextEl.textContent = `${Math.round(percentage)}%`;
    statusTextEl.textContent = status;
}

// --- Core Logic ---
async function startAnalysis() {
    if (state.isAnalyzing) return;

    state.apiKeys = apiKeyInputs.map(input => input.value.trim());
    const file = fileInput.files[0];
    if (state.apiKeys.some(key => !key) || !file) {
        alert('Vui l√≤ng nh·∫≠p ƒë·ªß 5 API Key v√† ch·ªçn t·ªáp d·ªØ li·ªáu.');
        return;
    }

    state.isAnalyzing = true;
    startButton.disabled = true;
    resultsCardEl.classList.add('hidden');
    analysisProgressEl.classList.remove('hidden');
    logContainer.innerHTML = '<p>Kh·ªüi t·∫°o m√¥i tr∆∞·ªùng nghi√™n c·ª©u... <span class="blinking-cursor">_</span></p>';
    
    try {
        logMessage('ƒêang ƒë·ªçc v√† h·ª£p nh·∫•t d·ªØ li·ªáu...');
        updateProgress(5, 'ƒê·ªçc d·ªØ li·ªáu...');
        const fileContent = await file.text();
        const importedSessions = JSON.parse(fileContent);
        state.fullHistory = Object.values(importedSessions).flatMap(s => s.history || []);
        
        if (state.fullHistory.length < 50) {
            throw new Error('D·ªØ li·ªáu qu√° ng·∫Øn. C·∫ßn √≠t nh·∫•t 50 v√°n c∆∞·ª£c.');
        }
        logMessage(`T·ªïng h·ª£p th√†nh c√¥ng ${state.fullHistory.length} v√°n c∆∞·ª£c. H·ªôi ƒë·ªìng b·∫Øt ƒë·∫ßu l√†m vi·ªác.`);
        
        // Stage 1: Specialists work in parallel
        updateProgress(10, 'Giai ƒëo·∫°n 1: C√°c chuy√™n gia ph√¢n t√≠ch...');
        logMessage('H·ªèi √Ω ki·∫øn Chuy√™n gia C·∫ßu B·ªát, Chuy√™n gia M·∫´u H√¨nh, v√† Nh√† Th·ªëng K√™...');
        
        const specialistPrompts = getSpecialistPrompts(state.fullHistory);
        const specialistPromises = [
            callGemini(specialistPrompts.streak.system, specialistPrompts.streak.user, state.apiKeys[0]),
            callGemini(specialistPrompts.sequence.system, specialistPrompts.sequence.user, state.apiKeys[1]),
            callGemini(specialistPrompts.statistical.system, specialistPrompts.statistical.user, state.apiKeys[2]),
        ];
        
        const specialistResults = await Promise.all(specialistPromises);
        const [streakResult, sequenceResult, statisticalResult] = specialistResults.map(res => JSON.parse(res.candidates[0].content.parts[0].text));

        logMessage('C√°c chuy√™n gia ƒë√£ ƒë∆∞a ra √Ω ki·∫øn. Chuy·ªÉn cho Nh√† Ph·∫£n Bi·ªán.', true);

        // Stage 2: Contrarian analysis
        updateProgress(50, 'Giai ƒëo·∫°n 2: Nh√† Ph·∫£n Bi·ªán t√¨m k·∫Ω h·ªü...');
        const contrarianPrompt = getContrarianPrompt(state.fullHistory, [streakResult, sequenceResult, statisticalResult]);
        const contrarianResultJson = await callGemini(contrarianPrompt.system, contrarianPrompt.user, state.apiKeys[3]);
        const contrarianResult = JSON.parse(contrarianResultJson.candidates[0].content.parts[0].text);

        logMessage('Nh√† Ph·∫£n Bi·ªán ƒë√£ ho√†n th√†nh. Chuy·ªÉn t·∫•t c·∫£ cho Ch·ªß T·ªãch H·ªôi ƒê·ªìng.', true);

        // Stage 3: Lead Strategist synthesizes everything
        updateProgress(75, 'Giai ƒëo·∫°n 3: Ch·ªß T·ªãch H·ªôi ƒê·ªìng t·ªïng h·ª£p...');
        const leadPrompt = getLeadStrategistPrompt(state.fullHistory, [streakResult, sequenceResult, statisticalResult], contrarianResult);
        const leadResultJson = await callGemini(leadPrompt.system, leadPrompt.user, state.apiKeys[4]);
        const finalRuleset = JSON.parse(leadResultJson.candidates[0].content.parts[0].text);

        logMessage('Ch·ªß T·ªãch ƒë√£ ra quy·∫øt ƒë·ªãnh. B·∫Øt ƒë·∫ßu ki·ªÉm ch·ª©ng b·ªô quy lu·∫≠t cu·ªëi c√πng.');

        // Final Verification
        updateProgress(90, 'Ki·ªÉm ch·ª©ng l·∫ßn cu·ªëi...');
        const { accuracy } = await verifyRuleset(finalRuleset.rules);
        state.finalRuleset = { ...finalRuleset, accuracy };
        logMessage(`Ki·ªÉm ch·ª©ng ho√†n t·∫•t! ƒê·ªô ch√≠nh x√°c cu·ªëi c√πng: ${accuracy.toFixed(2)}%`, true);

        finalizeAnalysis();

    } catch (error) {
        logMessage(`L·ªñI NGHI√äM TR·ªåNG: ${error.message}`);
        alert(`ƒê√£ x·∫£y ra l·ªói: ${error.message}`);
        state.isAnalyzing = false;
        startButton.disabled = false;
        analysisProgressEl.classList.add('hidden');
    }
}

function finalizeAnalysis() {
    updateProgress(100, "Ho√†n t·∫•t!");
    document.getElementById('finalAccuracy').textContent = `${state.finalRuleset.accuracy.toFixed(2)}%`;
    document.getElementById('finalRules').textContent = state.finalRuleset.explanation;
    resultsCardEl.classList.remove('hidden');
    analysisProgressEl.classList.add('hidden');
    startButton.disabled = false;
    state.isAnalyzing = false;
}

function getSpecialistPrompts(history) {
    const historySnippet = `[${history.slice(0, 150).join(', ')}]... (t·ªïng c·ªông ${history.length} v√°n).`;
    const baseSystem = `You are a Baccarat analyst. Your task is to find rules to predict the outcome. Return your findings as a JSON object with "explanation" (in Vietnamese) and "rules" (a JSON array of machine-readable rule objects).`;

    return {
        streak: {
            system: baseSystem,
            user: `Ph√¢n t√≠ch chu·ªói Baccarat sau: ${historySnippet}\nH√£y ch·ªâ t·∫≠p trung v√†o c√°c quy lu·∫≠t C·∫¶U B·ªÜT (chu·ªói d√†i P ho·∫∑c B) v√† C·∫¶U 1-1 (P-B-P-B). ƒê·ªÅ xu·∫•t c√°c quy lu·∫≠t d·ª±a tr√™n ƒë·ªô d√†i c·ªßa c√°c chu·ªói n√†y v√† ƒëi·ªÉm g√£y c·ªßa ch√∫ng. B·ªè qua c√°c m·∫´u h√¨nh ng·∫Øn, ph·ª©c t·∫°p.`
        },
        sequence: {
            system: baseSystem,
            user: `Ph√¢n t√≠ch chu·ªói Baccarat sau: ${historySnippet}\nH√£y ch·ªâ t·∫≠p trung v√†o c√°c M·∫™U H√åNH NG·∫ÆN l·∫∑p l·∫°i (d√†i 3-5 tay, v√≠ d·ª•: 'BBP', 'PBPB'). ƒê·ªÅ xu·∫•t c√°c quy lu·∫≠t d·ª±a tr√™n k·∫øt qu·∫£ th∆∞·ªùng xu·∫•t hi·ªán sau c√°c m·∫´u h√¨nh n√†y. B·ªè qua c√°c c·∫ßu b·ªát d√†i.`
        },
        statistical: {
            system: baseSystem,
            user: `Ph√¢n t√≠ch chu·ªói Baccarat sau: ${historySnippet}\nH√£y ti·∫øp c·∫≠n d∆∞·ªõi g√≥c ƒë·ªô th·ªëng k√™. T√¨m ki·∫øm c√°c quy lu·∫≠t "h·ªìi quy v·ªÅ trung b√¨nh" (v√≠ d·ª•: sau m·ªôt chu·ªói d√†i P, li·ªáu B c√≥ kh·∫£ nƒÉng ra cao h∆°n kh√¥ng?). ƒê·ªÅ xu·∫•t c√°c quy lu·∫≠t d·ª±a tr√™n s·ª± m·∫•t c√¢n b·∫±ng trong ph√¢n ph·ªëi P/B t·ªïng th·ªÉ.`
        }
    };
}

function getContrarianPrompt(history, specialistResults) {
    const historySnippet = `[${history.slice(0, 150).join(', ')}]... (t·ªïng c·ªông ${history.length} v√°n).`;
    const system = `You are a contrarian Baccarat analyst. Your job is to find weaknesses in other analysts' rules. You must return your findings as a JSON object with "explanation" (in Vietnamese) and "rules" (a JSON array of machine-readable rule objects).`;
    const user = `D∆∞·ªõi ƒë√¢y l√† 3 b·ªô quy lu·∫≠t ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t b·ªüi c√°c chuy√™n gia kh√°c:\n\n1. Chuy√™n gia C·∫ßu B·ªát:\n${specialistResults[0].explanation}\n\n2. Chuy√™n gia M·∫´u H√¨nh:\n${specialistResults[1].explanation}\n\n3. Nh√† Th·ªëng K√™:\n${specialistResults[2].explanation}\n\nNhi·ªám v·ª• c·ªßa b·∫°n l√† xem x√©t to√†n b·ªô d·ªØ li·ªáu (${historySnippet}) v√† t√¨m ra c√°c NGO·∫†I L·ªÜ ho·∫∑c ƒêI·ªÇM Y·∫æU c·ªßa c√°c quy lu·∫≠t tr√™n. H√£y ƒë·ªÅ xu·∫•t m·ªôt b·ªô "Quy lu·∫≠t Ph·∫£n Bi·ªán" ƒë·ªÉ x√°c ƒë·ªãnh khi n√†o c√°c quy lu·∫≠t ch√≠nh c√≥ kh·∫£ nƒÉng sai.`;
    return { system, user };
}

function getLeadStrategistPrompt(history, specialistResults, contrarianResult) {
     const historySnippet = `[${history.slice(0, 150).join(', ')}]... (t·ªïng c·ªông ${history.length} v√°n).`;
     const system = `You are the Lead Strategist of a team of Baccarat analysts. Your task is to synthesize multiple analyses into a single, cohesive, and robust set of rules. You MUST return your final findings as a JSON object with "explanation" and "rules".`;
     const user = `B·∫°n l√† Ch·ªß T·ªãch H·ªôi ƒê·ªìng. B·∫°n ƒë√£ nh·∫≠n ƒë∆∞·ª£c ph√¢n t√≠ch t·ª´ 4 chuy√™n gia:\n\n1. Chuy√™n gia C·∫ßu B·ªát:\n${specialistResults[0].explanation}\n\n2. Chuy√™n gia M·∫´u H√¨nh:\n${specialistResults[1].explanation}\n\n3. Nh√† Th·ªëng K√™:\n${specialistResults[2].explanation}\n\n4. Nh√† Ph·∫£n Bi·ªán (ch·ªâ ra ƒëi·ªÉm y·∫øu):\n${contrarianResult.explanation}\n\nD·ª±a tr√™n TO√ÄN B·ªò d·ªØ li·ªáu (${historySnippet}), nhi·ªám v·ª• c·ªßa b·∫°n l√† t·ªïng h·ª£p t·∫•t c·∫£ th√¥ng tin n√†y ƒë·ªÉ t·∫°o ra m·ªôt B·ªò QUY LU·∫¨T CU·ªêI C√ôNG DUY NH·∫§T. H√£y ∆∞u ti√™n c√°c quy lu·∫≠t m·∫°nh nh·∫•t, s·ª≠ d·ª•ng c√°c quy lu·∫≠t ph·∫£n bi·ªán ƒë·ªÉ th√™m ƒëi·ªÅu ki·ªán ngo·∫°i l·ªá (v√≠ d·ª•: "Theo c·∫ßu b·ªát TR·ª™ KHI g·∫∑p m·∫´u XYZ"), v√† gi·∫£i quy·∫øt c√°c m√¢u thu·∫´n. M·ª•c ti√™u l√† b·ªô quy lu·∫≠t c√≥ ƒë·ªô ch√≠nh x√°c cao nh·∫•t.`;
     return { system, user };
}

async function callGemini(systemPrompt, userQuery, apiKey) {
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
    
    const payload = {
        contents: [{ parts: [{ text: userQuery }] }],
        systemInstruction: { parts: [{ text: systemPrompt }] },
        generationConfig: { responseMimeType: "application/json", temperature: 0.2 },
    };

    const response = await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
    });

    if (!response.ok) {
        const error = await response.json();
        throw new Error(`L·ªói API: ${error.error.message}`);
    }
    return response.json();
}

async function verifyRuleset(rules) {
    let correct = 0;
    let total = 0;
    const minHistory = 10;

    for (let i = minHistory; i < state.fullHistory.length; i++) {
        const historySlice = state.fullHistory.slice(0, i);
        const actualResult = state.fullHistory[i];

        let prediction = null;
        for (const rule of rules) {
            if (rule.type === 'streak') {
                const last = historySlice[historySlice.length - 1];
                let streak = 0;
                for (let j = historySlice.length - 1; j >= 0; j--) {
                    if (historySlice[j] === last) streak++; else break;
                }
                if (last === rule.value && streak >= rule.length) {
                    prediction = rule.prediction;
                    break;
                }
            } else if (rule.type === 'sequence') {
                if (historySlice.length >= rule.length) {
                    const recentSequence = historySlice.slice(-rule.length).join('');
                    if (recentSequence === rule.value) {
                        prediction = rule.prediction;
                        break;
                    }
                }
            }
        }

        if (prediction) {
            total++;
            if (prediction === actualResult) correct++;
        }
    }
    
    const accuracy = total > 0 ? (correct / total) * 100 : 0;
    return { accuracy, correct, total };
}

function downloadResults() {
    if (!state.finalRuleset.rules || state.finalRuleset.rules.length === 0) {
        alert("Ch∆∞a c√≥ quy lu·∫≠t n√†o ƒë·ªÉ t·∫£i v·ªÅ.");
        return;
    }
    
    const content = `# C√îNG TR√åNH NGHI√äN C·ª®U BACCARAT\n\n## ƒê·ªô ch√≠nh x√°c cu·ªëi c√πng: ${state.finalRuleset.accuracy.toFixed(2)}%\n\n---\n\n## Gi·∫£i th√≠ch quy lu·∫≠t\n\n${state.finalRuleset.explanation}\n\n---\n\n## D·ªØ li·ªáu quy lu·∫≠t (JSON)\n\n\`\`\`json\n${JSON.stringify(state.finalRuleset.rules, null, 2)}\n\`\`\``;
    
    const blob = new Blob([content], { type: 'text/markdown' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'cong-trinh-nghien-cuu-ai.md';
    link.click();
    URL.revokeObjectURL(link.href);
}

// --- Initial Setup ---
document.addEventListener('DOMContentLoaded', () => {
    checkCanStart();
});

</script>
</body>
</html>

